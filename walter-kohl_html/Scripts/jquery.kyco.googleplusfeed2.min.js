/***************************************\

	jquery.kyco.googleplusfeed
	==========================

	Version 2.0.4

	Brought to you by
	http://www.kycosoftware.com/

	Copyright 2014 Cornelius Weidmann

	Distributed under the GPL

\***************************************/

(function(d){var g={init:function(f){var e=d.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,orderBy:"date",sort:"asc",lang:"en"},f);return this.each(function(){function f(){function d(a){return'<div class="feed_post post_'+(a+1)+'"><span title="'+b(a,!0)+'">'+e.lang.shared+b(a)+"</span><p>"+r[a].content+'</p><a href="'+r[a].url+'" target="_blank">'+e.lang.viewPost+"</a></div>"}function b(e,a){a=a||!1;var d="",d=r[e].publishedDate.substr(0,19),b=d.split("T")[0],c=b.split("-")[0], l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")["01 02 03 04 05 06 07 08 09 10 11 12".split(" ").indexOf(b.split("-")[1])],b=b.split("-")[2],d=d.split("T").pop(),b=b+" "+l+" "+c;return a?b+" "+d:b}var r=m.entries,n=r.length,c=e.feedPosts,g=e.postsIncrement,l=0,x=!1,v=0,s=c,p="",c=n<c?n:c;if(0<n){for(;v<c;v++)p+=d(v);y.children("a").attr("href",m.url).text(m.screenName);w.attr("href",m.url);w.append('<img src="'+m.image+'" width="'+e.profileImageSize+'" height="'+e.profileImageSize+ '">');q.html(p);q.animate({scrollTop:0},1);a.fadeIn(300)}else a.children().remove(),h.text(e.lang.errorEmpty),t.text(e.lang.retryEmpty),h.append(t),a.append(h),a.fadeIn(300),a.find(".retry").click(function(){a.children().remove();a.append(k);k.show();m.getFeed()});u.click(function(){if(l<=n){l+=x?g:c+g;for(l=l>n?n:l;s<l;s++)p+=d(s),s===n-1&&(u.unbind("click").addClass("link"),u.text(e.lang.viewMore).click(function(){window.open(m.url)}));q.animate({scrollTop:q[0].scrollHeight},500);x=!0}q.html(p)})} var c=d(this);e.lang="en"===e.lang?{langCode:"en",loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+",shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",errorNotFound:"User not found... Enter a valid Google+ ID",retryGeneral:"Retry"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ", viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen",errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ",errorNotFound:"Benutzer nicht gefunden... Verwende einen g\u00fcltigen Google+ ID",retryGeneral:"Wiederholen"};var z=d('<div id="feed_'+c.attr("class")+'" class="kyco_googleplusfeed '+e.lang.langCode+'"></div>'),k=d('<div class="feed_loader">'+e.lang.loading+"</div>"),a=d('<div class="feed_wrapper"></div>'),g=d('<div class="feed_header"></div>'), y=d('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>'),w=d('<a href="#" class="feed_profile_image" target="_blank"></a>'),q=d('<div class="feed_content"></div>'),u=d('<span class="feed_sow_more">'+e.lang.showMore+"</span>"),h=d('<div class="error"></div>'),t=d('<span class="retry"></span>');g.append(w,y);a.append(g,q,u);z.append(k,a);c.append(z);var m=new function(c){var b=this;b.id=c;b.url="https://plus.google.com/"+b.id;b.init=function(){f()};b.getFeed=function(){d.ajax({type:"GET", url:"http://www.kycosoftware.com/api/googleplus-feed/"+b.id,dataType:"json",success:function(c){try{if("404"!=c&&!1!==c){var f=c.profile,g=c.activity;b.screenName=f.displayName;b.entries=function(a){for(var b=[],d=a.length,c=0,f=0;c<d;c++)f<e.maxPosts&&""!=a[c].object.content&&(b.push({url:a[c].object.url,publishedDate:a[c].published,content:a[c].object.content,plusones:a[c].object.plusoners.totalItems}),f++);"date"===e.orderBy?b.sort(function(a,b){return new Date(b.publishedDate)-new Date(a.publishedDate)}): "asc"===e.sort?b.sort(function(a,b){return b.plusones-a.plusones}):b.sort(function(a,b){return a.plusones-b.plusones});return b}(g.items);b.image=f.image.url.substr(0,f.image.url.indexOf("?"))+"?sz="+e.profileImageSize;d.get(b.image).fail(function(){b.image="http://www.kycosoftware.com/images/general/googleplus-404.png"}).always(function(){d('<img src="'+b.image+'">').load(function(){k.fadeOut(300,function(){k.remove();b.init()})})})}else"404"==c?k.fadeOut(300,function(){h.text(e.lang.errorNotFound); a.html(h);a.fadeIn(300)}):k.fadeOut(300,function(){h.text(e.lang.errorGeneral);a.html(h);a.fadeIn(300)})}catch(m){k.fadeOut(300,function(){a.children().remove();h.text(e.lang.errorGeneral);t.text(e.lang.retryGeneral);h.append(t);a.append(h);a.fadeIn(300);a.find(".retry").click(function(){a.children().remove();a.append(k);k.show();b.getFeed()})})}}})};b.getFeed()}(e.id)})}};d.fn.kycoGooglePlusFeed2=function(f){"forEach"in Array.prototype||(Array.prototype.forEach=function(d,f){for(var c=0,g=this.length;c< g;c++)c in this&&d.call(f,this[c],c,this)});"string"===typeof f&&(f={id:f});if(g[f])return g[f].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof f&&f)d.error("Method "+f+" does not exist on jQuery.kycoGooglePlusFeed2");else return g.init.apply(this,arguments)}})(jQuery);
